VALID_TOOLCHAINS := pnacl newlib glibc

include $(NACL_SDK_ROOT)/tools/common.mk

LIBS = ppapi_cpp ppapi
# CFLAGS = -Wall -Wno-long-long -pthread -Werror -std=c++0x -O2
# Use gnu++11 for pnacl
CFLAGS = -Wall -Wno-long-long -pthread -Werror -std=gnu++11 -O2 --pnacl-exceptions=sjlj
LDFLAGS = --pnacl-exceptions=sjlj

TARGET = osoasso_stress_test
SOURCES = 	src/sha1.cc\
			src/multiply.cc\
			test_harness/stress_test.cc\
			test/stress_test_blob.cc\
			test/stress_test_multiply.cc\
			test/stress_test_row_iterator.cc\
			test/stress_test_column_iterator.cc

# Build rules generated by macros from common.mk:

$(foreach src,$(SOURCES),$(eval $(call COMPILE_RULE,$(src),$(CFLAGS))))

ifeq ($(CONFIG),Release)
$(eval $(call LINK_RULE,$(TARGET)_unstripped,$(SOURCES),$(LIBS),$(DEPS), $(LDFLAGS)))
$(eval $(call STRIP_RULE,$(TARGET),$(TARGET)_unstripped))
else
$(eval $(call LINK_RULE,$(TARGET),$(SOURCES),$(LIBS),$(DEPS), $(LDFLAGS)))
endif

$(eval $(call NMF_RULE,$(TARGET),))
